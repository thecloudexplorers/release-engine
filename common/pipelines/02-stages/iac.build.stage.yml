parameters:
  - name: workloadSettings
    type: object

stages:
  - ${{ each stage in parameters.workloadSettings.stages }}:
    - stage: build_${{ replace(replace(stage.infrastructure.iac.name, '-', '_'), '.', '_') }}      
      displayName: 'Build - ${{ stage.infrastructure.iac.displayName }}'
      dependsOn:
      jobs:
        - ${{ if eq(parameters.workloadSettings.isBuiltInPattern, '') }}:
            - template: /common/pipelines/03-jobs/iac.build.job.yml
              parameters:
                workloadSettings: ${{ parameters.workloadSettings }}
        - ${{ else }}:
            - template: /common/pipelines/03-jobs/built-in-pattern.build.job.yml
              parameters:
                workloadSettings: ${{ parameters.workloadSettings }} 